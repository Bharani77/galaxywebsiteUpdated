(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[957],{3491:(e,t,r)=>{Promise.resolve().then(r.bind(r,2606))},2606:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var n=r(5155),s=r(5974),a=r(2115);let o=(0,s.UU)("https://sarsafeqetopciqjhzrt.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNhcnNhZmVxZXRvcGNpcWpoenJ0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzIzNTAwOTEsImV4cCI6MjA0NzkyNjA5MX0.cvIbQn7UbCrvjDVzA4-bB-UCsHM9gp9i1uVFWtPlH9c");function l(){let[e,t]=(0,a.useState)({"3month":"","6month":"","1year":""}),[r,s]=(0,a.useState)({"3month":!1,"6month":!1,"1year":!1}),[l,i]=(0,a.useState)({"3month":{},"6month":{},"1year":{}}),[c,d]=(0,a.useState)({"3month":[],"6month":[],"1year":[]}),[u,h]=(0,a.useState)([]),[m,x]=(0,a.useState)(!1),[p,g]=(0,a.useState)(null),[f,b]=(0,a.useState)("3month"),[y,k]=(0,a.useState)(!1),[j,w]=(0,a.useState)(null),[N,v]=(0,a.useState)(null),I=e=>{v(e),setTimeout(()=>v(null),3e3)},E=e=>{navigator.clipboard.writeText(e).then(()=>{I("Token copied to clipboard!")})},U=e=>{let r={"3month":"","6month":"","1year":""};Object.entries(e).forEach(e=>{let[t,n]=e,s=n.find(e=>"Active"===e.status);s&&(r[t]=s.token)}),t(r)},D=async e=>{s(t=>({...t,[e]:!0}));try{let t=Array(16).fill(0).map(()=>{let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";return e.charAt(Math.floor(Math.random()*e.length))}).join(""),{data:r,error:n}=await o.from("tokengenerate").insert([{token:t,duration:e,status:"Active"}]).select();if(n)throw n;if(r){let n={...c,[e]:[{token:t,status:"Active",id:r[0].id},...c[e].length>=5?c[e].slice(0,4):c[e]]};d(n),U(n),I("Token generated successfully!")}}catch(t){let e="Unknown error occurred";t instanceof Error?e=t.message:"object"==typeof t&&null!==t&&(e=JSON.stringify(t)),console.error("Error in generateToken:",t),I("Error: ".concat(e))}finally{s(t=>({...t,[e]:!1}))}},S=async(e,t)=>{if(!e){console.error("Token ID is undefined. Cannot delete."),I("Error deleting token: Token ID is missing.");return}i(r=>({...r,[t]:{...r[t],[e]:!0}}));try{let{error:r}=await o.from("tokengenerate").delete().eq("id",e);if(r)throw r;let n={...c,[t]:c[t].filter(t=>t.id!==e)};d(n),U(n),G()}catch(t){let e="Unknown error occurred";t instanceof Error?e=t.message:"object"==typeof t&&null!==t&&(e=JSON.stringify(t)),console.error("Error during token deletion:",t),I("Error deleting token: ".concat(e))}finally{i(r=>({...r,[t]:{...r[t],[e]:!1}}))}},C=async(e,t)=>{if(!e||!t){console.error("User ID or Token is missing."),I("Error: User ID or Token is missing.");return}try{let{error:r}=await o.from("users").delete().eq("id",e);if(r)throw r;let{error:n}=await o.from("tokengenerate").delete().eq("token",t);if(n)throw n;console.log("User and associated token deleted successfully!"),I("User and associated token deleted successfully!");let s={...c};Object.keys(s).forEach(e=>{s[e]=s[e].filter(e=>e.token!==t)}),d(s),U(s),G()}catch(t){let e="Unknown error occurred";t instanceof Error?e=t.message:"object"==typeof t&&null!==t&&(e=JSON.stringify(t)),console.error("Error in handleDeleteUser:",e),I("Error: ".concat(e))}},A=(e,t)=>{w({userId:e,token:t}),k(!0)},T=()=>{k(!1),w(null)},O=async e=>{if(!j)return;let{userId:t,token:r}=j;if("token"===e)try{let{error:e}=await o.from("tokengenerate").delete().eq("token",r);if(e)throw e;let{error:n}=await o.from("users").update({token:null}).eq("id",t);if(n)throw n;let s={...c};Object.keys(s).forEach(e=>{s[e]=s[e].filter(e=>e.token!==r)}),d(s),U(s),I("Token deleted successfully!"),G()}catch(e){console.error("Error deleting token:",e),I("Error deleting token")}else"user"===e&&C(t,r);T()},M=e=>{g(e),x(!0)},J=()=>{x(!1),g(null),b("3month")},q=async()=>{if(!p){console.error("User ID is missing."),I("Error: User ID is missing.");return}try{let{data:e,error:t}=await o.from("tokengenerate").select("token, expiresat").eq("userid",p).not("token","is",null).neq("token","").single();if(t&&"PGRST116"!==t.code)throw t;if(e){let t=new Date(e.expiresat);if(new Date<t){I("User already has an active token. Please delete the existing token before renewing.");return}{let{error:t}=await o.from("tokengenerate").delete().eq("token",e.token);if(t)throw t}}let r=Array(16).fill(0).map(()=>{let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";return e.charAt(Math.floor(Math.random()*e.length))}).join(""),n=new Date().toISOString(),s=new Date;switch(f){case"3month":s.setMonth(s.getMonth()+3);break;case"6month":s.setMonth(s.getMonth()+6);break;case"1year":s.setFullYear(s.getFullYear()+1);break;default:throw Error("Invalid duration")}let{data:a,error:l}=await o.from("tokengenerate").insert([{token:r,createdat:n,expiresat:s.toISOString(),duration:f,status:"InUse",userid:p}]).select();if(l)throw l;let{data:i,error:c}=await o.from("users").update({token:r}).eq("id",p).select();if(c)throw c;a&&i&&(I("Token renewed successfully!"),G(),z(),J())}catch(t){let e="Unknown error occurred";t instanceof Error?e=t.message:"object"==typeof t&&null!==t&&(e=JSON.stringify(t)),console.error("Error renewing token:",e),I("Error renewing token: ".concat(e))}},z=(0,a.useCallback)(async()=>{try{let{data:e,error:t}=await o.from("tokengenerate").select("id, token, status, duration, createdat, expiresat, userid").order("createdat",{ascending:!1});if(t)throw t;let r={"3month":[],"6month":[],"1year":[]};e.forEach(e=>{r[e.duration]&&r[e.duration].push({token:e.token,status:e.status,id:e.id})}),d(r),U(r)}catch(t){let e="Unknown error occurred";t instanceof Error?e=t.message:"object"==typeof t&&null!==t&&(e=JSON.stringify(t)),console.error("Error fetching token history:",e)}},[]),G=async()=>{try{let{data:e,error:t}=await o.from("users").select("id, username, token");if(t)throw t;let{data:r,error:n}=await o.from("tokengenerate").select("token, duration, createdat, expiresat, userid");if(n)throw n;let s=e.map(e=>{let t=r.find(t=>t.userid===e.id);return{token:(null==t?void 0:t.token)||e.token||"N/A",duration:(null==t?void 0:t.duration)||"N/A",createdat:(null==t?void 0:t.createdat)||"N/A",expiresat:(null==t?void 0:t.expiresat)||null,username:e.username||"N/A",userId:e.id||null}});h(s)}catch(t){let e="Unknown error occurred";t instanceof Error?e=t.message:"object"==typeof t&&null!==t&&(e=JSON.stringify(t)),console.error("Error fetching token user details:",e)}};(0,a.useEffect)(()=>{G(),z()},[z]);let R=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"}),F=e=>new Date>new Date(e),V=(e,t)=>"N/A"===e||null===t?"N/A":F(t)?"Expired":"InUse";return(0,n.jsxs)("div",{className:"min-h-screen bg-gray-900 text-white p-4",children:[(0,n.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold mb-6 text-center",children:"Admin Dashboard - Token Generator"}),N&&(0,n.jsx)("div",{className:"fixed bottom-4 right-4 bg-green-600 text-white px-4 py-2 rounded-lg shadow-lg",children:N}),(0,n.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:Object.keys(e).map(t=>(0,n.jsxs)("div",{className:"bg-gray-800 p-6 rounded-lg",children:[(0,n.jsxs)("h3",{className:"text-lg font-bold mb-4",children:[t.charAt(0).toUpperCase()+t.slice(1)," Token"]}),(0,n.jsxs)("div",{className:"bg-gray-700 p-3 rounded mb-4 break-all flex items-center justify-between",children:[(0,n.jsx)("span",{className:"text-sm font-mono flex-1 truncate mr-2",children:e[t]?e[t]:"No active token"}),(0,n.jsx)("span",{className:"text-xs ".concat(e[t]?"text-green-500":"text-gray-400"),children:e[t]?"Active":""})]}),(0,n.jsx)("button",{className:"w-full py-2 px-4 rounded font-semibold ".concat(r[t]?"bg-purple-700 cursor-not-allowed":"bg-purple-600 hover:bg-purple-700"),onClick:()=>D(t),disabled:r[t],children:r[t]?"Generating...":"Generate Token"}),(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsx)("h4",{className:"text-sm font-bold mb-2",children:"Token History"}),(0,n.jsx)("div",{className:"max-h-40 overflow-y-auto scrollbar-thin scrollbar-thumb-purple-600 scrollbar-track-gray-700 scrollbar-rounded",children:c[t].map((e,r)=>(0,n.jsxs)("div",{className:"bg-gray-700 p-2 rounded mb-2 text-sm flex justify-between items-center",children:[(0,n.jsxs)("div",{className:"flex-1 truncate mr-2",children:[(0,n.jsx)("span",{className:"font-mono",children:e.token}),(0,n.jsx)("span",{className:"ml-2 ".concat("Active"===e.status?"text-green-500":"InUse"===e.status?"text-red-500":"text-gray-400"),children:e.status})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("button",{onClick:()=>E(e.token),className:"text-blue-500 hover:text-blue-700 px-2 py-1 rounded",children:"Copy"}),"Active"===e.status&&(0,n.jsx)("button",{onClick:()=>S(e.id,t),disabled:l[t][e.id]||!1,className:"text-red-500 hover:text-red-700 px-2 py-1 rounded ".concat(l[t][e.id]?"opacity-50 cursor-not-allowed":""),children:l[t][e.id]?"Deleting...":"Delete"})]})]},r))})]})]},t))}),(0,n.jsxs)("div",{className:"mt-8",children:[(0,n.jsx)("h3",{className:"text-xl font-bold mb-4",children:"Token User Details"}),(0,n.jsx)("div",{className:"bg-gray-800 p-6 rounded-lg overflow-x-auto",children:(0,n.jsxs)("table",{className:"w-full table-auto border border-gray-600",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{className:"bg-gray-700",children:[(0,n.jsx)("th",{className:"px-4 py-2 min-w-[200px] text-left",children:"Token"}),(0,n.jsx)("th",{className:"px-4 py-2 min-w-[100px] text-left",children:"Duration"}),(0,n.jsx)("th",{className:"px-4 py-2 min-w-[150px] text-left",children:"Username"}),(0,n.jsx)("th",{className:"px-4 py-2 min-w-[200px] text-left",children:"Created At"}),(0,n.jsx)("th",{className:"px-4 py-2 min-w-[200px] text-left",children:"Expires At"}),(0,n.jsx)("th",{className:"px-4 py-2 min-w-[100px] text-left",children:"Status"}),(0,n.jsx)("th",{className:"px-4 py-2 min-w-[100px] text-left",children:"Actions"})]})}),(0,n.jsx)("tbody",{children:u.length>0?u.map((e,t)=>{let r=V(e.token,e.expiresat);return(0,n.jsxs)("tr",{className:"text-sm ".concat(t%2==0?"bg-gray-800":"bg-gray-700"," hover:bg-gray-600"),children:[(0,n.jsx)("td",{className:"px-4 py-2 break-all whitespace-nowrap",children:e.token}),(0,n.jsx)("td",{className:"px-4 py-2 whitespace-nowrap",children:e.duration}),(0,n.jsx)("td",{className:"px-4 py-2 whitespace-nowrap",children:e.username}),(0,n.jsx)("td",{className:"px-4 py-2 whitespace-nowrap",children:R(e.createdat)}),(0,n.jsx)("td",{className:"px-4 py-2 whitespace-nowrap",children:e.expiresat?R(e.expiresat):"N/A"}),(0,n.jsx)("td",{className:"px-4 py-2 whitespace-nowrap",children:(0,n.jsx)("span",{className:"px-2 py-1 rounded text-sm ".concat("InUse"===r?"bg-red-500":"Expired"===r?"bg-green-500":"bg-yellow-500"),children:r})}),(0,n.jsxs)("td",{className:"px-4 py-2 whitespace-nowrap",children:[(0,n.jsx)("button",{onClick:()=>{e.userId&&e.token?A(e.userId,e.token):(console.error("User ID or Token is missing."),I("Error: User ID or Token is missing."))},className:"text-red-500 hover:text-red-700 px-2 py-1 rounded",children:"Delete"}),(0,n.jsx)("button",{onClick:()=>{e.userId?M(e.userId):(console.error("User ID is missing."),I("Error: User ID is missing."))},className:"text-blue-500 hover:text-blue-700 px-2 py-1 rounded ml-2",children:"Renew Token"})]})]},t)}):(0,n.jsx)("tr",{children:(0,n.jsx)("td",{colSpan:7,className:"text-center py-4",children:"No token user details available."})})})]})})]})]}),m&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"bg-gray-800 p-6 rounded-lg w-96",children:[(0,n.jsx)("h3",{className:"text-lg font-bold mb-4",children:"Renew Token"}),(0,n.jsxs)("label",{className:"block mb-4",children:[(0,n.jsx)("span",{className:"text-sm font-semibold",children:"Select Duration:"}),(0,n.jsxs)("select",{value:f,onChange:e=>b(e.target.value),className:"w-full p-2 bg-gray-700 rounded mt-1",children:[(0,n.jsx)("option",{value:"3month",children:"3 Months"}),(0,n.jsx)("option",{value:"6month",children:"6 Months"}),(0,n.jsx)("option",{value:"1year",children:"1 Year"})]})]}),(0,n.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,n.jsx)("button",{onClick:J,className:"bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded",children:"Cancel"}),(0,n.jsx)("button",{onClick:q,className:"bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded",children:"Renew"})]})]})}),y&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"bg-gray-800 p-6 rounded-lg w-96",children:[(0,n.jsx)("h3",{className:"text-lg font-bold mb-4",children:"Delete Confirmation"}),(0,n.jsx)("p",{className:"mb-4",children:"What do you want to delete?"}),(0,n.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,n.jsx)("button",{onClick:()=>O("token"),className:"bg-red-600 hover:bg-red-700 px-4 py-2 rounded",children:"Delete Token"}),(0,n.jsx)("button",{onClick:()=>O("user"),className:"bg-red-600 hover:bg-red-700 px-4 py-2 rounded",children:"Delete User"}),(0,n.jsx)("button",{onClick:T,className:"bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded",children:"Cancel"})]})]})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[736,441,517,358],()=>t(3491)),_N_E=e.O()}]);